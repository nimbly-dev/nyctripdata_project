{% macro generate_schema_name(custom_schema_name, node) -%}
    {%- if node.config.schema is defined and node.config.schema != '' -%}
        {{ log("generate_schema_name: Using schema from node config: " ~ node.config.schema, info=True) }}
        {{ node.config.schema }}
    {%- elif custom_schema_name is not none -%}
        {% set result = target.schema ~ "_" ~ (custom_schema_name | trim) %}
        {{ log("generate_schema_name: Using target.schema with custom: " ~ result, info=True) }}
        {{ result }}
    {%- else -%}
        {{ log("generate_schema_name: Using target.schema: " ~ target.schema, info=True) }}
        {{ target.schema }}
    {%- endif %}
{%- endmacro %}
